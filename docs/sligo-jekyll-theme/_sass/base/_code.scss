// =============================================================================
// CODE BLOCKS & SYNTAX HIGHLIGHTING
// =============================================================================

// Code block container
.highlight,
pre.highlight,
div.highlighter-rouge {
  position: relative;
  margin: $space-6 0;
  border-radius: $radius-lg;
  overflow: hidden;
}

// Pre element
pre {
  margin: 0;
  padding: $space-5;
  overflow-x: auto;
  font-family: $font-mono;
  font-size: $text-sm;
  line-height: $leading-relaxed;
  background-color: var(--code-bg);
  color: var(--code-text);
  -webkit-overflow-scrolling: touch;
  
  code {
    display: block;
    padding: 0;
    background: none;
    border-radius: 0;
    color: inherit;
    font-size: inherit;
  }
}

// Language label
.highlight::before,
div.highlighter-rouge::before {
  content: attr(data-lang);
  position: absolute;
  top: 0;
  right: $space-12; // Leave room for copy button
  padding: $space-1 $space-3;
  font-family: $font-body;
  font-size: $text-xs;
  font-weight: $weight-medium;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  color: var(--color-muted);
  background-color: var(--bg-hover);
  border-radius: 0 0 $radius-sm $radius-sm;
}

// Copy button
.code-copy-btn {
  position: absolute;
  top: $space-2;
  right: $space-2;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  padding: 0;
  background-color: var(--bg-hover);
  border: 1px solid var(--border-color);
  border-radius: $radius-md;
  color: var(--color-muted);
  cursor: pointer;
  opacity: 0;
  transition: opacity $transition-fast, background-color $transition-fast, color $transition-fast;
  
  svg {
    width: 18px;
    height: 18px;
  }
  
  &:hover {
    background-color: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
  }
  
  &.copied {
    background-color: var(--color-success);
    border-color: var(--color-success);
    color: white;
  }
}

.highlight:hover .code-copy-btn,
div.highlighter-rouge:hover .code-copy-btn {
  opacity: 1;
}

// Line numbers (optional)
.highlight .lineno,
.rouge-gutter {
  padding-right: $space-4;
  color: var(--color-muted);
  border-right: 1px solid var(--border-color);
  user-select: none;
}

.rouge-code {
  padding-left: $space-4;
}

// =============================================================================
// SYNTAX HIGHLIGHTING - SLIGO THEME
// Based on One Dark Pro with Sligo brand colors
// =============================================================================

// Light mode syntax colors
:root {
  --syntax-comment: #6A737D;
  --syntax-keyword: #{$color-secondary};
  --syntax-string: #{$color-success};
  --syntax-number: #D19A66;
  --syntax-function: #{$color-primary};
  --syntax-variable: #E06C75;
  --syntax-operator: #56B6C2;
  --syntax-class: #E5C07B;
  --syntax-attribute: #D19A66;
  --syntax-tag: #E06C75;
  --syntax-constant: #D19A66;
  --syntax-symbol: #61AFEF;
  --syntax-regex: #98C379;
  --syntax-inserted: #{$color-success};
  --syntax-deleted: #{$color-error};
}

// Dark mode syntax colors
[data-theme="dark"] {
  --syntax-comment: #5C6370;
  --syntax-keyword: #C678DD;
  --syntax-string: #98C379;
  --syntax-number: #D19A66;
  --syntax-function: #61AFEF;
  --syntax-variable: #E06C75;
  --syntax-operator: #56B6C2;
  --syntax-class: #E5C07B;
  --syntax-attribute: #D19A66;
  --syntax-tag: #E06C75;
  --syntax-constant: #D19A66;
  --syntax-symbol: #61AFEF;
  --syntax-regex: #98C379;
  --syntax-inserted: #98C379;
  --syntax-deleted: #E06C75;
}

// Rouge/Pygments syntax classes
.highlight {
  // Comments
  .c, .c1, .cm, .cs, .cd { 
    color: var(--syntax-comment); 
    font-style: italic;
  }
  
  // Keywords
  .k, .kc, .kd, .kn, .kp, .kr, .kt, .kv {
    color: var(--syntax-keyword);
    font-weight: $weight-medium;
  }
  
  // Strings
  .s, .s1, .s2, .sb, .sc, .sd, .se, .sh, .si, .sx, .sr, .ss {
    color: var(--syntax-string);
  }
  
  // Numbers
  .m, .mb, .mf, .mh, .mi, .mo, .mx, .il {
    color: var(--syntax-number);
  }
  
  // Functions & Methods
  .nf, .fm, .nb, .nc {
    color: var(--syntax-function);
  }
  
  // Variables
  .nv, .vi, .vg, .vc, .vm {
    color: var(--syntax-variable);
  }
  
  // Operators
  .o, .ow {
    color: var(--syntax-operator);
  }
  
  // Classes & Types
  .nc, .nn, .no {
    color: var(--syntax-class);
  }
  
  // Attributes
  .na, .nd {
    color: var(--syntax-attribute);
  }
  
  // Tags (HTML/XML)
  .nt {
    color: var(--syntax-tag);
  }
  
  // Constants
  .bp, .ne {
    color: var(--syntax-constant);
  }
  
  // Symbols
  .nl, .py {
    color: var(--syntax-symbol);
  }
  
  // Regex
  .sr {
    color: var(--syntax-regex);
  }
  
  // Generic
  .ge { font-style: italic; }
  .gs { font-weight: $weight-bold; }
  .gd { color: var(--syntax-deleted); background-color: rgba($color-error, 0.1); }
  .gi { color: var(--syntax-inserted); background-color: rgba($color-success, 0.1); }
  
  // Errors
  .err {
    color: var(--syntax-deleted);
    background-color: rgba($color-error, 0.1);
  }
  
  // Punctuation
  .p, .pi {
    color: var(--code-text);
  }
  
  // Names
  .n, .ni {
    color: var(--code-text);
  }
}

// =============================================================================
// LANGUAGE-SPECIFIC ADJUSTMENTS
// =============================================================================

// Terraform/HCL
.language-hcl,
.language-terraform,
.language-tf {
  .na { color: var(--syntax-attribute); }
  .s, .s2 { color: var(--syntax-string); }
}

// YAML
.language-yaml,
.language-yml {
  .na { color: var(--syntax-keyword); }
  .s { color: var(--syntax-string); }
}

// Shell/Bash
.language-bash,
.language-shell,
.language-sh {
  .nb { color: var(--syntax-function); }
  .nv { color: var(--syntax-variable); }
}

// JSON
.language-json {
  .nl { color: var(--syntax-attribute); }
  .s2 { color: var(--syntax-string); }
}

// =============================================================================
// DIFF HIGHLIGHTING
// =============================================================================

.language-diff {
  .gd {
    display: block;
    padding: 0 $space-4;
    margin: 0 #{-$space-5};
    background-color: rgba($color-error, 0.15);
    
    &::before {
      content: "- ";
      color: var(--syntax-deleted);
    }
  }
  
  .gi {
    display: block;
    padding: 0 $space-4;
    margin: 0 #{-$space-5};
    background-color: rgba($color-success, 0.15);
    
    &::before {
      content: "+ ";
      color: var(--syntax-inserted);
    }
  }
}

// =============================================================================
// CODE BLOCK TITLE/FILENAME
// =============================================================================

.code-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: $space-2 $space-4;
  background-color: var(--bg-hover);
  border-bottom: 1px solid var(--border-color);
  font-family: $font-mono;
  font-size: $text-xs;
  
  .filename {
    display: flex;
    align-items: center;
    gap: $space-2;
    color: var(--color-muted);
    
    svg {
      width: 14px;
      height: 14px;
    }
  }
  
  .language {
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-muted);
  }
}

// Code block with header
.code-block {
  border: 1px solid var(--border-color);
  border-radius: $radius-lg;
  overflow: hidden;
  
  .highlight,
  div.highlighter-rouge {
    margin: 0;
    border-radius: 0;
  }
  
  pre {
    border-radius: 0;
  }
}
